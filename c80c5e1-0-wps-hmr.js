webpackHotUpdate(0,{3:function(e,t,r){"use strict";var i=function(){function e(e,t){this.maxParticles=t,this.spawnRate=1e4,this.particlesToSpawn=0;var r=new Float32Array(8*t);this.vertexBuffer=e.createBuffer(r)}return e.prototype.update=function(e){var t=new Float32Array(this.vertexBuffer.contents);this.particlesToSpawn+=e*this.spawnRate;for(var r=0;r<this.maxParticles;++r){var i=t[8*r+3]-e;if(i>0){for(var a=0;a<3;++a)t[8*r+a]+=t[8*r+4+a]*e;t[8*r+3]=i}else if(this.particlesToSpawn>1){for(a=0;a<3;++a)t[8*r+a]=0;var n=void 0;do{n=0;for(a=0;a<3;++a){var s=2*Math.random()-1;t[8*r+4+a]=.2*s,n+=s*s}}while(n>1);t[8*r+3]=1+Math.random(),--this.particlesToSpawn}}},e.prototype.draw=function(){},e}(),a=function(){function e(e){this.app=e;var t=e.library.functionWithName("particle_vertex_main"),r=e.library.functionWithName("fragment_main");this.emitter=new i(e.gpu,1e3);var a=new WebMetalRenderPipelineDescriptor;a.vertexFunction=t,a.fragmentFunction=r,a.colorAttachments[0].pixelFormat=e.gpu.PixelFormatBGRA8Unorm,this.renderPipelineState=e.gpu.createRenderPipelineState(a),this.renderPassDescriptor=new WebMetalRenderPassDescriptor,this.renderPassDescriptor.colorAttachments[0].loadAction=e.gpu.LoadActionClear,this.renderPassDescriptor.colorAttachments[0].storeAction=e.gpu.StoreActionStore,this.renderPassDescriptor.colorAttachments[0].clearColor=[.35,.65,.85,1]}return e.prototype.update=function(){this.emitter.update(.03333)},e.prototype.render=function(){var e=this.app.commandQueue.createCommandBuffer(),t=this.app.gpu.nextDrawable();this.renderPassDescriptor.colorAttachments[0].texture=t.texture;var r=e.createRenderCommandEncoderWithDescriptor(this.renderPassDescriptor);r.setRenderPipelineState(this.renderPipelineState),r.setVertexBuffer(this.emitter.vertexBuffer,0,0),r.drawPrimitives(this.app.gpu.PrimitiveTypePoint,0,this.emitter.maxParticles),r.endEncoding(),e.presentDrawable(t),e.commit()},e}(),n=function(){function e(e){if(this.canvas=e,this.lastTick=0,this.gpu=e.getContext("webgpu"),!this.gpu)throw new Error("Failed to create webmetal context");this.commandQueue=this.gpu.createCommandQueue(),this.library=this.gpu.createLibrary(document.getElementById("library").text),this.particleRenderPass=new a(this),this.lastTick=Date.now(),setInterval(this.update.bind(this),1e3/30),this.render()}return e.prototype.update=function(){var e=Date.now();this.lastTick;this.lastTick=e,this.particleRenderPass.update()},e.prototype.render=function(){this.particleRenderPass.render(),requestAnimationFrame(this.render.bind(this))},e}();window.onload=function(){new n(document.getElementById("canvas"))}}});
//# sourceMappingURL=c80c5e1-0-wps-hmr.js.map